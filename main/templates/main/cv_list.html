{% extends 'main/base.html' %}
{% block title %}CVs - CVProject{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-start mb-4">
    <div>
        <h1 class="mb-2">
            <i class="bi bi-file-text me-2"></i>List of CVs
        </h1>
        <p class="text-muted mb-0">Manage and organize your professional CVs</p>
    </div>
    <a href="{% url 'cv_create' %}" class="btn btn-primary">
        <i class="bi bi-plus-circle me-2"></i>Create New CV
    </a>
</div>

{% if messages %}
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    {% endfor %}
{% endif %}

<!-- Search and Sort Controls -->
<div class="row mb-4">
    <div class="col-md-6">
        <form method="get" action="" class="d-flex gap-2">
            <input type="text" name="q" value="{{ q }}" class="form-control" placeholder="Search CVs by name..."/>
            <button type="submit" class="btn btn-outline-secondary">
                <i class="bi bi-search"></i>
            </button>
        </form>
    </div>
    
    <div class="col-md-6">
        <form method="get" action="" class="d-flex gap-2 flex-wrap">
            <!-- Preserve search query -->
            {% if q %}
                <input type="hidden" name="q" value="{{ q }}">
            {% endif %}
            
            <select name="sort" id="sort" class="form-select" style="min-width: 140px;">
                <option value="created_at" {% if sort_by == "created_at" %}selected{% endif %}>Date Created</option>
                <option value="updated_at" {% if sort_by == "updated_at" %}selected{% endif %}>Last Updated</option>
                <option value="firstname" {% if sort_by == "firstname" %}selected{% endif %}>First Name</option>
                <option value="lastname" {% if sort_by == "lastname" %}selected{% endif %}>Last Name</option>
            </select>
            
            <select name="order" id="order" class="form-select" style="min-width: 120px;">
                <option value="desc" {% if order == "desc" %}selected{% endif %}>Newest First</option>
                <option value="asc" {% if order == "asc" %}selected{% endif %}>Oldest First</option>
            </select>
            
            <button type="submit" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-repeat me-1"></i>Sort
            </button>
        </form>
    </div>
</div>

<!-- CV Grid -->
{% if cvs %}
<div class="row g-4">
    {% for cv in cvs %}
    <div class="col-lg-4 col-md-6">
        <div class="card cv-card h-100 shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-start">
                <h5 class="card-title mb-0">{{ cv.firstname }} {{ cv.lastname }}</h5>
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-three-dots-vertical"></i>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'cv_detail' cv.pk %}">
                            <i class="bi bi-eye me-2"></i>View
                        </a></li>
                        {% if user.is_superuser or cv.owner == user %}
                            <li><a class="dropdown-item" href="{% url 'cv_update' cv.pk %}">
                                <i class="bi bi-pencil me-2"></i>Edit
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item text-danger" href="{% url 'cv_delete' cv.pk %}">
                                <i class="bi bi-trash me-2"></i>Delete
                            </a></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="cv-preview">
                    <div class="mb-3">
                        <strong>Bio:</strong>
                        <p class="mb-0">{{ cv.bio|truncatewords:20 }}</p>
                    </div>
                    <div>
                        <strong>Skills:</strong>
                        <p class="mb-0">{{ cv.skills|truncatewords:15 }}</p>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-light">
                <small class="text-muted">
                    <i class="bi bi-calendar-plus me-1"></i>Created: {{ cv.created_at|date:"M d, Y H:i" }}
                    {% if cv.updated_at != cv.created_at %}
                        <br><i class="bi bi-calendar-check me-1"></i>Updated: {{ cv.updated_at|date:"M d, Y H:i" }}
                    {% endif %}
                </small>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <div class="mb-4">
        <i class="bi bi-file-text display-1 text-muted"></i>
    </div>
    <h3 class="mb-3">No CVs Found</h3>
    <p class="text-muted mb-4">You haven't created any CVs yet. Get started by creating your first professional CV.</p>
    <a href="{% url 'cv_create' %}" class="btn btn-primary btn-lg">
        <i class="bi bi-plus-circle me-2"></i>Create Your First CV
    </a>
</div>
{% endif %}

{% endblock %}

